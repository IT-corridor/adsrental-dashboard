LoadModule ssl_module /usr/lib/apache2/modules/mod_ssl.so
LoadModule proxy_module /usr/lib/apache2/modules/mod_proxy.so
LoadModule proxy_http_module /usr/lib/apache2/modules/mod_proxy_http.so
LoadModule socache_shmcb_module /usr/lib/apache2/modules/mod_socache_shmcb.so

Listen 80
MaxRequestWorkers 1000
ServerLimit 1000
SSLSessionCache "shmcb:${APACHE_LOG_DIR}/ssl_scache(51200)"

<IfModule mod_ssl.c>
    Listen 443
    <VirtualHost *:443>
        ServerName adsrental.com
        ServerAdmin vlad.e@toptal.com
        DocumentRoot /var/www/html/app/
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on
        SSLCertificateFile "/var/www/html/cert/adsrental_com.crt"
        SSLCertificateKeyFile "/var/www/html/cert/csr.key"
        SSLCertificateChainFile "/var/www/html/cert/adsrental_com.ca-bundle"

        ProxyPass /app/ http://web:8007/app/
        ProxyPassReverse /app/ http://web:8007/app/
        ProxyPass /static/ http://web:8007/static/
        ProxyPassReverse /static/ http://web:8007/static/

        Alias /log "/var/www/html/log/"
        <Directory /var/www/html/log/>
            Options +Indexes
        </Directory>
        Alias /uploads "/var/www/html/uploads/"
        # Redirect permanent / https://adsrental.com/app/
    </VirtualHost>
</IfModule>

<VirtualHost *:80>
    ServerName adsrental.com
    ServerAdmin vlad.e@toptal.com
    # DocumentRoot /var/www/html/app/
    # Alias /.well-known/pki-validation "/var/www/html/app/"
    Redirect permanent / https://adsrental.com/
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet