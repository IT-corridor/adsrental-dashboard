{% extends 'base.html' %}

{% load bootstrap %}
{% load humanize %}
{% load helpers %}

{% block title %}Adsrental | Dashboard{% endblock %}

{% block content %}
<div class="container">

    <form role="form" action="" method="GET" class="form-horizontal">
        <div class="form-group">
            <label class="control-label col-sm-2 col-lg-2">UTM Source</label>
            <div class=" col-sm-10 col-lg-10 ">
                <input class="form-control" type="text" value="{{ utm_source|default:"Not set" }}" readonly>
            </div>
        </div>
        {{ form|bootstrap_horizontal }}
        <div class="form-group">
          <div class="col-sm-10 col-sm-offset-2">
            <button type="submit" class="btn btn-primary">Search</button>
          </div>
        </div>
    </form>
</div>

    <table id="results" class="table table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th><a href="{% relative_url request.GET.urlencode 'order' 'first_name' %}">Lead</a></th>
                <th><a href="{% relative_url request.GET.urlencode 'order' 'account_name' %}">Account</a></th>
                <th><a href="{% relative_url request.GET.urlencode 'order' 'utm_source' %}">UTM</a></th>
                <th>Facebook</th>
                <th><a href="{% relative_url request.GET.urlencode 'order' 'status' %}">Status</a></th>
                <th><a href="{% relative_url request.GET.urlencode 'order' 'phone' %}">Phone</a></th>
                <th>Address</th>
                <th>Google</th>
                <th>Facebook</th>
                <th>Online</th>
                <th><a href="{% relative_url request.GET.urlencode 'order' '-raspberry_pi__first_seen' %}">First Seen</a></th>
                <th><a href="{% relative_url request.GET.urlencode 'order' '-raspberry_pi__last_seen' %}">Last Seen</a></th>
                <th><a href="{% relative_url request.GET.urlencode 'order' '-raspberry_pi__tunnel_last_tested' %}">Tunnel Last Tested</a></th>
                <th>Bundler Paid</th>
                <th>Wrong Password</th>
                <th>Pi delivered</th>
                <th>Sent</th>
            </tr>
        </thead>
        {% for entry in entries %}
            <tbody>
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{entry.first_name}} {{entry.last_name}}</td>
                    <td>{{ entry.account_name }}</td>
                    <td>{{ entry.utm_source }}</td>
                    <td>{{ entry.fb_email }}</td>
                    <td>{{ entry.status }}</td>
                    <td>{{entry.phone}}</td>
                    <td>
                        {{ entry.address }}
                        {% if entry.usps_tracking_code %}
                            <br />    
                            USPS: {{entry.usps_tracking_code}}
                        {% endif %}
                    </td>
                    <td>
                        {% if entry.google_account %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span>{% endif %}
                        {{ entry.google_account_status }}
                    </td>
                    <td>
                        {% if entry.facebook_account %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span>{% endif %}
                        {{ entry.facebook_account_status }}
                    </td>
                    <td>
                        {% if entry.raspberry_pi.online %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span> Online{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span> Offline{% endif %}
                        <br />
                        {% if entry.raspberry_pi.tunnel_online %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span> Tunnel Online{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span> Tunnel Offline{% endif %}
                    </td>
                    <td>{{entry.raspberry_pi.get_first_seen|naturaltime|default:"Never"}}</td>
                    <td>{{entry.raspberry_pi.get_last_seen|naturaltime|default:"Never"}}</td>
                    <td>
                        {{entry.raspberry_pi.get_tunnel_last_tested|naturaltime|default:"Never"}}
                    </td>
                    <td>
                        {% if entry.bundler_paid %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span>{% endif %}   
                    </td>
                    <td>
                        {% if entry.wrong_password_date %}<span class="glyphicon glyphicon-ok" style="color: red;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: lightgreen;"></span>{% endif %}   
                    </td>
                    <td>
                        {% if entry.pi_delivered %}<span class="glyphicon glyphicon-ok" style="color: lightgreen;"></span>{% else %}<span class="glyphicon glyphicon-remove" style="color: red;"></span>{% endif %}           
                    </td>
                    <td>
                        {% if entry.get_pi_sent_this_month %}
                            <span class="glyphicon glyphicon-ok" style="color: lightgreen;" title="{{entry.pi_sent|naturaltime|default:"Never"}}"></span>
                        {% else %}
                            <span class="glyphicon glyphicon-remove" style="color: red;" title="{{entry.pi_sent|naturaltime|default:"Never"}}"</span>
                            <form action="{% url "dashboard_check_sent" %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="leadid" value="{{entry.leadid}}">
                                <button class="btn btn-default">Check sent</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        {% empty %}
            <tfoot>
                <tr>
                    <th colspan="100">No entries found</th>
                </tr>
            </tfoot>
        {% endfor %}
    </table>
    {% if entries.has_other_pages %}
      <ul class="pagination">
        {% if entries.has_previous %}
          <li><a href="{% relative_url request.GET.urlencode 'page' entries.previous_page_number %}">&laquo;</a></li>
        {% else %}
          <li class="disabled"><span>&laquo;</span></li>
        {% endif %}
        {% for i in entries.paginator.page_range %}
          {% if entries.number == i %}
            <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
          {% else %}
            <li><a href="{% relative_url request.GET.urlencode 'page' i %}">{{ i }}</a></li>
          {% endif %}
        {% endfor %}
        {% if entries.has_next %}
          <li><a href="{% relative_url request.GET.urlencode 'page' entries.next_page_number %}">&raquo;</a></li>
        {% else %}
          <li class="disabled"><span>&raquo;</span></li>
        {% endif %}
      </ul>
    {% endif %}
{% endblock %}
